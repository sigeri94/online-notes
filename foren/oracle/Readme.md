
# Oracle Database 19c â€“ Setup & Lab SAWITDB (Windows)

Dokumentasi langkah-langkah setup **Oracle Database 19c** di Windows, pembuatan database **SAWITDB**, user, schema contoh perkebunan sawit, backup (Data Pump & RMAN), serta auditing.

script rotasi log dan backup
https://chatgpt.com/s/t_697d672d9ea48191bc0ae4e6c28da089
---

## 1. Environment Variable

```bat
set ORACLE_SID=SAWITDB
set ORACLE_HOME=D:\oracle_win
set PATH=%ORACLE_HOME%\bin;%PATH%
````

---

## 2. Struktur Direktori

```bat
mkdir D:\ORADATA\SAWITDB
mkdir D:\ORADATA\SAWITDB\REDO
mkdir D:\oracle\admin\SAWITDB\adump
```

---

## 3. Inisialisasi Database (PFILE)

File: `D:\oracle_win\database\initSAWITDB.ora`

```ini
db_name=SAWITDB
memory_target=1G
processes=200
audit_file_dest='D:\oracle\admin\SAWITDB\adump'
compatible='19.0.0'
control_files='D:\ORADATA\SAWITDB\control01.ctl'
undo_tablespace=UNDOTBS1
```

---

## 4. Membuat Oracle Service

```bat
oradim -NEW -SID SAWITDB -STARTMODE MANUAL
```

```sql
STARTUP NOMOUNT;
SELECT status FROM v$instance;
```

---

## 5. Membuat Database

```sql
CREATE DATABASE SAWITDB
   USER SYS IDENTIFIED BY sys123
   USER SYSTEM IDENTIFIED BY system123
   LOGFILE
     GROUP 1 ('D:\ORADATA\SAWITDB\REDO\redo01.log') SIZE 100M,
     GROUP 2 ('D:\ORADATA\SAWITDB\REDO\redo02.log') SIZE 100M,
     GROUP 3 ('D:\ORADATA\SAWITDB\REDO\redo03.log') SIZE 100M
   MAXLOGFILES 32
   MAXDATAFILES 100
   CHARACTER SET AL32UTF8
   NATIONAL CHARACTER SET AL16UTF16
   DATAFILE 'D:\ORADATA\SAWITDB\system01.dbf'
     SIZE 700M AUTOEXTEND ON NEXT 50M
   SYSAUX DATAFILE 'D:\ORADATA\SAWITDB\sysaux01.dbf'
     SIZE 550M AUTOEXTEND ON NEXT 50M
   UNDO TABLESPACE undotbs1
     DATAFILE 'D:\ORADATA\SAWITDB\undo01.dbf'
     SIZE 200M AUTOEXTEND ON
   DEFAULT TEMPORARY TABLESPACE temp
     TEMPFILE 'D:\ORADATA\SAWITDB\temp01.dbf'
     SIZE 200M;
```

```sql
ALTER DATABASE OPEN;
@?/rdbms/admin/catalog.sql
@?/rdbms/admin/catproc.sql

SELECT name, open_mode FROM v$database;
```

---

## 6. Tablespace & User Aplikasi

ðŸ”¹ Buat USERS
```sql
CREATE TABLESPACE USERS DATAFILE 'D:\ORADATA\SAWITDB\users01.dbf'
SIZE 500M
AUTOEXTEND ON NEXT 50M; 
```

Fungsi USERS:
user non-aplikasi
user laporan
user admin
user sementara

ðŸ”¹ Buat APPDATA
```sql
CREATE TABLESPACE APPDATA DATAFILE 'D:\ORADATA\SAWITDB\appdata01.dbf'
SIZE 10G
AUTOEXTEND ON NEXT 1G; 
```

Fungsi APPDATA:
SELURUH data aplikasi sawit
transaksi
master
index
LOB (bisa dipisah nanti)

ðŸ”¹ Buat user aplikasi
```sql
CREATE USER SAWIT_APP IDENTIFIED BY StrongPass
DEFAULT TABLESPACE APPDATA
TEMPORARY TABLESPACE TEMP; 

GRANT CONNECT, RESOURCE TO SAWIT_APP; 
```

---

## 7. Schema Perkebunan Sawit

Login:

```sql
sqlplus sawit_lab/sawit123
```

### Tabel

```sql
CREATE TABLE KEBUN (
    KEBUN_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAMA_KEBUN VARCHAR2(100),
    LOKASI VARCHAR2(100),
    LUAS_HA NUMBER(8,2)
);

CREATE TABLE PETANI (
    PETANI_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAMA VARCHAR2(100),
    NO_KTP VARCHAR2(20)
);

CREATE TABLE BLOK_KEBUN (
    BLOK_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    KEBUN_ID NUMBER,
    KODE_BLOK VARCHAR2(10),
    CONSTRAINT FK_BLOK FOREIGN KEY (KEBUN_ID)
        REFERENCES KEBUN (KEBUN_ID)
);

CREATE TABLE PRODUKSI_SAWIT (
    PRODUKSI_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BLOK_ID NUMBER,
    PETANI_ID NUMBER,
    TANGGAL DATE,
    BERAT_KG NUMBER(10,2),
    CONSTRAINT FK_PROD_BLOK FOREIGN KEY (BLOK_ID)
        REFERENCES BLOK_KEBUN (BLOK_ID),
    CONSTRAINT FK_PROD_PETANI FOREIGN KEY (PETANI_ID)
        REFERENCES PETANI (PETANI_ID)
);
```

### Data Contoh

```sql
INSERT INTO KEBUN VALUES (DEFAULT,'Kebun Jaya','Riau',1200);
INSERT INTO KEBUN VALUES (DEFAULT,'Kebun Makmur','Sumsel',950);

INSERT INTO PETANI VALUES (DEFAULT,'Budi','1401');
INSERT INTO PETANI VALUES (DEFAULT,'Andi','1602');
INSERT INTO PETANI VALUES (DEFAULT,'Rudi','1503');

INSERT INTO BLOK_KEBUN VALUES (DEFAULT,1,'A01');
INSERT INTO BLOK_KEBUN VALUES (DEFAULT,1,'A02');
INSERT INTO BLOK_KEBUN VALUES (DEFAULT,2,'B01');
```

```sql
BEGIN
  FOR i IN 1..50 LOOP
    INSERT INTO PRODUKSI_SAWIT
    (BLOK_ID, PETANI_ID, TANGGAL, BERAT_KG)
    VALUES
    (
      MOD(i,3)+1,
      MOD(i,3)+1,
      DATE '2025-01-01' + MOD(i,30),
      ROUND(DBMS_RANDOM.VALUE(2000,4500),2)
    );
  END LOOP;
END;
/
COMMIT;
```

---

## 8. Backup Data Pump (EXPDP)

```sql
CREATE OR REPLACE DIRECTORY DP_BACKUP AS
'D:\oracle\backup\SAWITDB';
```

```bat
mkdir D:\oracle\backup\SAWITDB
```

```sql
CREATE USER DACEN IDENTIFIED BY dacen123;
GRANT CREATE SESSION TO DACEN;
GRANT READ, WRITE ON DIRECTORY DP_BACKUP TO DACEN;
GRANT DATAPUMP_EXP_FULL_DATABASE TO DACEN;
```

```bat
expdp dacen/dacen123@SAWITDB ^
full=y ^
directory=DP_BACKUP ^
dumpfile=full_sawitdb.dmp ^
logfile=full_sawitdb.log
```

---

## 9. Backup Listener

```bat
@echo off
set ORACLE_HOME=C:\oracle\product\19c\dbhome_1
set SRC=%ORACLE_HOME%\network\admin
set DEST=D:\oracle\backup\listener

xcopy "%SRC%\*.ora" "%DEST%\" /Y /I
echo Listener backup done %DATE% %TIME% >> %DEST%\backup_listener.log
```

---

## 10. Auditing

```sql
ALTER SYSTEM SET audit_trail=DB,EXTENDED SCOPE=SPFILE;

AUDIT INSERT, UPDATE, DELETE
ON SAWIT_LAB.KEBUN
BY ACCESS;

AUDIT INSERT, UPDATE, DELETE
ON SAWIT_LAB.PRODUKSI_SAWIT
BY ACCESS;
```

```sql
SELECT username, action_name, obj_name, extended_timestamp
FROM dba_audit_trail
ORDER BY extended_timestamp DESC;
```

---

## 11. Backup RMAN

```sql
CREATE USER DACEN_RMAN IDENTIFIED BY dacen123;
GRANT SYSBACKUP TO DACEN_RMAN;
```

```rman
BACKUP DATABASE
FORMAT 'D:\oracle\backup\rman\db_%T_%U.bkp';

BACKUP CURRENT CONTROLFILE
FORMAT 'D:\oracle\backup\rman\ctrl_%T_%U.ctl';

CONFIGURE CONTROLFILE AUTOBACKUP ON;
SHOW CONTROLFILE AUTOBACKUP;
```

---

## 12. User Monitoring & Maintenance

### Monitoring

```sql
CREATE USER DBA_MON IDENTIFIED BY mon123;
GRANT SELECT_CATALOG_ROLE TO DBA_MON;
GRANT SELECT ANY DICTIONARY TO DBA_MON;
GRANT CREATE SESSION TO DBA_MON;
```

### Maintenance

```sql
CREATE USER DBA_MAINT IDENTIFIED BY maint123;
GRANT DBA TO DBA_MAINT;
GRANT ALTER SYSTEM TO DBA_MAINT;
GRANT ALTER DATABASE TO DBA_MAINT;
GRANT EXP_FULL_DATABASE TO DBA_MAINT;
GRANT IMP_FULL_DATABASE TO DBA_MAINT;
```

### Audit User DBA

```sql
AUDIT CREATE SESSION BY DBA_MON;
AUDIT CREATE SESSION BY DBA_MAINT;
AUDIT ALTER SYSTEM BY DBA_MAINT;
AUDIT CREATE USER BY DBA_MAINT;
```

```sql
SELECT username, action_name, extended_timestamp
FROM dba_audit_trail
WHERE username IN ('DBA_MON','DBA_MAINT');
```
